<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Risk Assessment — simplified chart area</title>

<!-- Chart.js (v4) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root{
    --bg:#f7fafc;
    --card:#ffffff;
    --muted:#6b7280;
    --accent1:#3b82f6;
    --accent2:#8b5cf6;
    --btn-grad: linear-gradient(135deg,var(--accent1),var(--accent2) 50%);
    --radius:12px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:Inter,system-ui,Arial;color:#0b1220}
  .wrap{max-width:1100px;margin:28px auto;padding:18px}
  .card{background:var(--card);border-radius:var(--radius);padding:18px}
  h1{margin:0 0 6px;font-size:20px}
  .muted{color:var(--muted);font-size:13px;margin-bottom:12px}

  .columns{display:grid;grid-template-columns:1fr 440px;gap:20px;align-items:start}
  .section{margin-bottom:12px}
  label{display:block;font-weight:700;color:#374151;margin-bottom:6px;font-size:13px}
  input[type="number"], select, textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e8eb;background:#fff;font-size:14px}
  .row{display:flex;gap:10px}
  .small{width:120px;flex:0 0 120px}

  .qgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:6px}
  .optionBtn{padding:10px 10px;border-radius:8px;border:1px solid #e6e8eb;background:#fff;cursor:pointer;text-align:left;font-size:14px}
  .optionBtn.active{border-color:transparent; box-shadow:0 24px 20px rgba(59,130,246,0.12); background: linear-gradient(180deg,#f8fbff,#ffffff)}

  .btn{display:inline-block;padding:12px 16px;border-radius:12px;border:0;color:white;font-weight:800;background:var(--btn-grad);cursor:pointer}
  .secondary{background:#eef2ff;color:#0b1220;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}

  .resultBox{background:linear-gradient(180deg,#fff,#fbfdff);border-radius:10px;padding:12px;margin-bottom:8px}
  .profile{font-size:18px;font-weight:800}
  .score{font-size:28px;font-weight:900;color:#14908b}
  .smallMuted{font-size:13px;color:var(--muted)}

  /* simplified chart area: minimal visual chrome */
  .chartArea{background:transparent;padding-top:6px}
  .controls{display:flex;gap:8px;align-items:center;margin:8px 0}
  .donutWrap{width:380px;height:380px;margin:8px auto;position:relative}
  canvas{width:100% !important;height:100% !important;display:block}
  .center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none}
  .center .label{font-size:13px;color:var(--muted)}
  .center .val{font-weight:800;font-size:20px}
  .hidden{display:none}

  /* slider: full width gradient track */
  .sliderWrap{padding:8px;border-radius:8px;border:1px solid #eef2ff;background:#fcfdff}
  #expSlider{
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 12px;
    border-radius: 999px;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6 50%);
    outline: none;
    margin-top: 6px;
  }
  #expSlider::-webkit-slider-thumb{
    -webkit-appearance: none; width:20px;height:20px;border-radius:50%;background:#fff;box-shadow:0 4px 10px rgba(11,18,32,0.15);border:2px solid rgba(255,255,255,0.5);
  }
  #expSlider::-moz-range-thumb{ width:20px;height:20px;border-radius:50%;background:#fff;box-shadow:0 4px 10px rgba(11,18,32,0.15);border:2px solid rgba(255,255,255,0.5); }
  #expSlider::-moz-range-track{ height:12px;border-radius:999px;background: linear-gradient(135deg, #3b82f6, #8b5cf6 50%); }

  @media (max-width:980px){
    .columns{grid-template-columns:1fr}
    .donutWrap{width:300px;height:300px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-label="Risk Assessment Calculator (non-weighted)">
      <h1>Risk Assessment Calculator</h1>
      <div class="muted">Answer 4 quick questions and click Calculate</div>

      <div class="columns">
        <!-- LEFT column: questions (unchanged) -->
        <div>
          <div class="section">
            <label for="age">Age</label>
            <input id="age" type="number" min="18" max="100" value="35" />
          </div>

          <div class="section">
            <label for="amount">Investable amount (₹)</label>
            <input id="amount" type="number" min="0" value="10000" />
          </div>

          <div class="section">
            <label for="horizon">Investment horizon</label>
            <select id="horizon">
              <option value="1">Under 1 year</option>
              <option value="3">1-3 years</option>
              <option value="5">3-5 years</option>
              <option value="10">5-10 years</option>
              <option value="15" selected>10+ years</option>
            </select>
          </div>

          <div class="section">
            <label>1) If your portfolio drops 20% in a year, what would you do?</label>
            <div class="qgrid" data-q="q1">
              <button class="optionBtn" data-val="0">Sell everything</button>
              <button class="optionBtn" data-val="1">Sell some</button>
              <button class="optionBtn" data-val="3">Hold</button>
              <button class="optionBtn" data-val="5">Buy more</button>
            </div>
          </div>

          <div class="section">
            <label>2) What is your primary financial goal?</label>
            <div class="qgrid" data-q="q2">
              <button class="optionBtn" data-val="0">Capital preservation</button>
              <button class="optionBtn" data-val="2">Income</button>
              <button class="optionBtn" data-val="4">Wealth growth</button>
              <button class="optionBtn" data-val="5">Aggressive growth</button>
            </div>
          </div>

          <div class="section">
            <label>3) Investment experience</label>
            <div class="sliderWrap" data-q="q3">
              <input id="expSlider" type="range" min="0" max="3" step="1" value="1" />
              <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px">
                <div>0-2</div><div>2-5</div><div>5-7</div><div>10+</div>
              </div>
              <div style="margin-top:8px;font-size:13px;color:var(--muted)">Selected: <span id="expLabel">2-5</span></div>
            </div>
          </div>

          <div class="section">
            <label>4) Reaction to volatility — you prefer:</label>
            <div class="qgrid" data-q="q4">
              <button class="optionBtn" data-val="0">Low volatility, low returns</button>
              <button class="optionBtn" data-val="2">Balanced risk/return</button>
              <button class="optionBtn" data-val="4">Higher risk for higher returns</button>
              <button class="optionBtn" data-val="5">Maximum return despite swings</button>
            </div>
          </div>

          <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
            <button id="calculateBtn" class="btn">Calculate</button>
            <button id="resetBtn" class="secondary">Reset</button>
          </div>
        </div>

        <!-- RIGHT column: simplified chart area showing only buttons + donut -->
        <div>
          <div class="resultBox" role="status" aria-live="polite">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="smallMuted">Risk score</div>
                <div class="score" id="scoreVal">—</div>
              </div>
              <div style="text-align:right">
                <div class="profile" id="profileLabel">—</div>
                <div id="profileDesc" class="smallMuted" style="max-width:220px"></div>
              </div>
            </div>
          </div>

          <div class="chartArea">
            <!-- ONLY the two buttons are visible now -->
            <div class="controls" aria-hidden="false">
              <button id="toggleBtn" class="secondary" aria-pressed="false">Show 9-field donut</button>
              <button id="updateBtn" class="btn" style="padding:8px 12px;font-weight:700">Update chart</button>
            </div>

            <!-- keep inputs hidden (used to populate chart behind the scenes) -->
            <div id="inputs3" class="hidden">
              <input id="f3_1" type="number" value="40">
              <input id="f3_2" type="number" value="35">
              <input id="f3_3" type="number" value="25">
            </div>
            <div id="inputs9" class="hidden">
              <input id="f9_1" type="number" value="15">
              <input id="f9_2" type="number" value="7">
              <input id="f9_3" type="number" value="35">
              <input id="f9_4" type="number" value="25">
              <input id="f9_5" type="number" value="10">
              <input id="f9_6" type="number" value="5">
              <input id="f9_7" type="number" value="7">
              <input id="f9_8" type="number" value="3">
              <input id="f9_9" type="number" value="2">
            </div>

            <div class="donutWrap" aria-hidden="false">
              <canvas id="mainCanvas" width="380" height="380"></canvas>
              <div class="center">
                <div class="val" id="centerText">—</div>
                <div class="label" id="centerLabel">—</div>
              </div>
            </div>

          </div>
        </div>
      </div> <!-- columns -->
    </div> <!-- card -->
  </div> <!-- wrap -->

<script>
/* ===== Helpers ===== */
const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

const ASSET_CLASSES = [
  'FD','Gold','Stocks','Mutual Funds','Real estate','Cash','Bonds','Pre-IPO shares','Alternate assets'
];

const PROFILE_ALLOCATIONS = {
  'Conservative': {'FD':25,'Gold':5,'Stocks':10,'Mutual Funds':10,'Real estate':15,'Cash':15,'Bonds':15,'Pre-IPO shares':0,'Alternate assets':5},
  'Moderate':     {'FD':15,'Gold':7,'Stocks':25,'Mutual Funds':20,'Real estate':10,'Cash':8,'Bonds':10,'Pre-IPO shares':2,'Alternate assets':3},
  'Growth':       {'FD':5,'Gold':8,'Stocks':35,'Mutual Funds':25,'Real estate':10,'Cash':5,'Bonds':7,'Pre-IPO shares':3,'Alternate assets':2},
  'Aggressive':   {'FD':0,'Gold':5,'Stocks':50,'Mutual Funds':25,'Real estate':8,'Cash':2,'Bonds':3,'Pre-IPO shares':5,'Alternate assets':2}
};

/* read option for grid (q3 is slider) */
function readOption(gridName){
  if (gridName === 'q3'){
    const s = document.getElementById('expSlider');
    const map = [0,2,4,5];
    return map[Number(s.value)] ?? null;
  }
  const grid = document.querySelector(`[data-q="${gridName}"]`);
  if (!grid) return null;
  const btn = grid.querySelector('.optionBtn.active');
  return btn ? Number(btn.dataset.val) : null;
}

/* option clicks */
document.querySelectorAll('.qgrid').forEach(g => {
  g.addEventListener('click', (e) => {
    const btn = e.target.closest('.optionBtn');
    if (!btn) return;
    g.querySelectorAll('.optionBtn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  });
});

/* slider label */
const expSlider = document.getElementById('expSlider');
const expLabel = document.getElementById('expLabel');
const expLabels = ['0-2','2-5','5-7','10+'];
if (expSlider) expSlider.addEventListener('input', e => { expLabel.textContent = expLabels[Number(e.target.value)] || ''; });

/* ===== Chart (minimal legend hidden) ===== */
const canvas = document.getElementById('mainCanvas');
let currentChart = null;
let showingNine = false;

function makeGradients(n, ctx){
  const rect = canvas.getBoundingClientRect();
  const h = Math.max(canvas.height, Math.round(rect.height));
  const gArr = [];
  for (let i=0;i<n;i++){
    const t = i / Math.max(1, n-1);
    const top = Math.round(220 - t*160);
    const bottom = Math.max(20, top - 90);
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0, `rgb(${top},${top},${top})`);
    g.addColorStop(1, `rgb(${bottom},${bottom},${bottom})`);
    gArr.push(g);
  }
  return gArr;
}

function destroyChart(){
  if (currentChart){ try{ currentChart.destroy(); }catch(e){} currentChart = null; }
}

function createThreeFieldDonut(){
  destroyChart();
  const ctx = canvas.getContext('2d');
  const v1 = Number(document.getElementById('f3_1').value) || 0;
  const v2 = Number(document.getElementById('f3_2').value) || 0;
  const v3 = Number(document.getElementById('f3_3').value) || 0;
  const raw = [v1,v2,v3];
  const totalRaw = raw.reduce((s,x)=>s+x,0) || 1;
  const p1 = Math.round((v1/totalRaw)*100);
  const p2 = Math.round((v2/totalRaw)*100);
  const p3 = 100 - (p1 + p2);
  const data = [p1,p2,p3];
  const labels = ['Safe (FD/Cash/Bonds)','Tangible (Gold/Real/Alt)','Growth (Stocks/MFs/Pre-IPO)'];

  const gradients = makeGradients(data.length, ctx);

  currentChart = new Chart(ctx, {
    type: 'doughnut',
    data: { labels, datasets:[{ data, backgroundColor:gradients, borderWidth:0, cutout:'62%', rotation:-0.25*Math.PI, hoverOffset:8 }]},
    options: {
      maintainAspectRatio:false,
      plugins:{ legend:{ display:false }, tooltip:{ callbacks:{ label: c => `${c.label}: ${c.raw}%` } } }
    }
  });

  document.getElementById('centerText').textContent = `${totalRaw}`;
  document.getElementById('centerLabel').textContent = 'Total (raw)';
}

function createNineFieldDonut(){
  destroyChart();
  const ctx = canvas.getContext('2d');
  const rawVals = [];
  for (let i=1;i<=9;i++) rawVals.push(Number(document.getElementById('f9_'+i).value) || 0);
  const labelsAll = ASSET_CLASSES.slice();
  const filtered = rawVals.map((v,i)=>({v,label:labelsAll[i]})).filter(x=>x.v>0);
  const totalRaw = filtered.reduce((s,x)=>s+x.v,0) || 0;
  if (totalRaw === 0){
    currentChart = new Chart(ctx, { type:'doughnut', data:{ labels:['No data'], datasets:[{ data:[100], backgroundColor:['#eee'], cutout:'62%'}]}, options:{maintainAspectRatio:false, plugins:{legend:{display:false}}}});
    document.getElementById('centerText').textContent = '0';
    document.getElementById('centerLabel').textContent = 'Total (raw)';
    return;
  }
  const percents = filtered.map(x => Math.round((x.v/totalRaw)*100));
  let diff = 100 - percents.reduce((s,n)=>s+n,0);
  while (diff !== 0){
    let idx = percents.indexOf(Math.max(...percents));
    percents[idx] += (diff>0?1:-1);
    diff = 100 - percents.reduce((s,n)=>s+n,0);
  }
  const labels = filtered.map(x=>x.label);
  const gradients = makeGradients(percents.length, ctx);

  currentChart = new Chart(ctx, {
    type:'doughnut',
    data:{ labels, datasets:[{ data:percents, backgroundColor:gradients, borderWidth:0, cutout:'62%', rotation:-0.25*Math.PI, hoverOffset:8 }]},
    options:{ maintainAspectRatio:false, plugins:{ legend:{ display:false }, tooltip:{ callbacks:{ label:c=>`${c.label}: ${c.raw}%` } } } }
  });

  document.getElementById('centerText').textContent = `${totalRaw}`;
  document.getElementById('centerLabel').textContent = 'Total (raw)';
}

/* Toggle handler: still toggles chart types, but inputs remain hidden */
document.getElementById('toggleBtn').addEventListener('click', () => {
  showingNine = !showingNine;
  const toggleBtn = document.getElementById('toggleBtn');
  toggleBtn.textContent = showingNine ? 'Show 3-field donut' : 'Show 9-field donut';
  toggleBtn.setAttribute('aria-pressed', String(showingNine));
  if (showingNine) createNineFieldDonut(); else createThreeFieldDonut();
});
document.getElementById('updateBtn').addEventListener('click', () => {
  if (showingNine) createNineFieldDonut(); else createThreeFieldDonut();
});

/* scoring functions (unchanged) */
function computeScoreNonWeighted(){
  const age = Number(document.getElementById('age').value) || 35;
  const ageRaw = clamp((65-age)/(65-18),0,1);
  const ageFactor = Math.round(ageRaw*25);
  const horizon = Number(document.getElementById('horizon').value) || 5;
  const horizonRaw = clamp((Math.log(horizon+1)/Math.log(16)),0,1);
  const horizonFactor = Math.round(horizonRaw*25);
  let qSum = 0; const Q_COUNT = 4;
  for (let i=1;i<=Q_COUNT;i++){
    const val = readOption('q'+i);
    if (val === null) return { err: `Please answer question ${i}` };
    qSum += val;
  }
  const qFactor = Math.round((qSum/(Q_COUNT*5))*50);
  const rawTotal = ageFactor + horizonFactor + qFactor;
  const score = Math.round(clamp(rawTotal,0,100));
  return { score, ageFactor, horizonFactor, qFactor, qSum };
}
function profileForScore(score){
  if (score < 30) return { id:'Conservative', ...PROFILE_ALLOCATIONS['Conservative'] };
  if (score < 50) return { id:'Moderate', ...PROFILE_ALLOCATIONS['Moderate'] };
  if (score < 70) return { id:'Growth', ...PROFILE_ALLOCATIONS['Growth'] };
  return { id:'Aggressive', ...PROFILE_ALLOCATIONS['Aggressive'] };
}

/* Populate hidden inputs from allocations */
function populateChartInputsFromAllocation(alloc){
  for (let i=0;i<ASSET_CLASSES.length;i++){
    const id = 'f9_'+(i+1);
    const el = document.getElementById(id);
    if (el) el.value = alloc[ASSET_CLASSES[i]] || 0;
  }
  const f1 = (alloc['FD']||0)+(alloc['Cash']||0)+(alloc['Bonds']||0);
  const f2 = (alloc['Gold']||0)+(alloc['Real estate']||0)+(alloc['Alternate assets']||0);
  const f3 = (alloc['Stocks']||0)+(alloc['Mutual Funds']||0)+(alloc['Pre-IPO shares']||0);
  document.getElementById('f3_1').value = Math.round(f1);
  document.getElementById('f3_2').value = Math.round(f2);
  document.getElementById('f3_3').value = Math.round(f3);
}

/* update UI & chart */
function updateUI(){
  const res = computeScoreNonWeighted();
  if (res.err){ alert(res.err); return; }
  document.getElementById('scoreVal').textContent = res.score;
  const profAll = profileForScore(res.score);
  document.getElementById('profileLabel').textContent = profAll.id;
  document.getElementById('profileDesc').textContent =
    profAll.id === 'Conservative' ? 'Capital preservation; low equity exposure.' :
    profAll.id === 'Moderate' ? 'Balanced growth with income focus.' :
    profAll.id === 'Growth' ? 'Growth-oriented; higher equity exposure.' : 'High growth appetite; mostly equities.';
  populateChartInputsFromAllocation(profAll);
  if (showingNine) createNineFieldDonut(); else createThreeFieldDonut();
}

/* wiring calculate/reset */
document.getElementById('calculateBtn').addEventListener('click', updateUI);
document.getElementById('resetBtn').addEventListener('click', () => {
  document.getElementById('age').value = 35;
  document.getElementById('amount').value = 200000;
  document.getElementById('horizon').value = 15;
  document.querySelectorAll('.qgrid').forEach((g)=>{ g.querySelectorAll('.optionBtn').forEach(b=>b.classList.remove('active')); const opts = g.querySelectorAll('.optionBtn'); if (opts.length) opts[Math.floor(opts.length/2)].classList.add('active'); });
  const s = document.getElementById('expSlider'); if (s){ s.value = 1; s.dispatchEvent(new Event('input')); }
  updateUI();
});

/* init */
(function init(){
  for (let i=1;i<=4;i++){
    const grid = document.querySelector(`[data-q="q${i}"]`);
    if (grid){ const opts = grid.querySelectorAll('.optionBtn'); if (opts.length) opts[Math.floor(opts.length/2)].classList.add('active'); }
  }
  if (expSlider){ expSlider.value = 1; expSlider.dispatchEvent(new Event('input')); }
  const initialProfile = profileForScore(50);
  populateChartInputsFromAllocation(initialProfile);
  createThreeFieldDonut();
})();
</script>
</body>
</html>
